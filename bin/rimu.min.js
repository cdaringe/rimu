var Rimu;(function(e){function t(t,r){return typeof r=="undefined"&&(r={}),e.Variables.reset(),e.Options.update(r),n(t)}function n(t){var n=new e.Reader(t),r=new e.Writer;while(!n.eof()){n.skipBlankLines();if(n.eof())break;if(e.LineBlocks.render(n,r))continue;if(e.Lists.render(n,r))continue;if(e.DelimitedBlocks.render(n,r))continue}return r.toString()}e.render=t,e.renderSource=n})(Rimu||(Rimu={})),typeof exports!="undefined"&&(exports.render=Rimu.render);var Rimu;(function(e){function t(e){return e.replace(/^\s+/g,"")}function n(e){return e.replace(/\s+$/g,"")}function r(e){return e.replace(/^\s+|\s+$/g,"")}function i(e){return e.replace(/[\-\/\\\^$*+?.()|\[\]{}]/g,"\\$&")}function s(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}function o(e,t,n){return typeof n=="undefined"&&(n={}),t.replace(/\$\d/g,function(){var t=parseInt(arguments[0][1]),r=e[t];return u(r,n)})}function u(t,n){return n.variables&&(t=e.Variables.render(t)),n.spans?e.Spans.render(t):n.specials?s(t):t}function a(t){if(!t||!e.LineBlocks.htmlAttributes)return t;var n=t.match(/^<[a-zA-Z]+(?=[ >])/);if(!n)return t;var r=t.slice(0,n[0].length),i=t.slice(n[0].length),s=r+" "+e.LineBlocks.htmlAttributes+i;return e.LineBlocks.htmlAttributes="",s}e.trimLeft=t,e.trimRight=n,e.trim=r,e.escapeRegExp=i,e.replaceSpecialChars=s,e.replaceMatch=o,e.replaceOptions=u,e.injectAttributes=a})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){function n(e){t.safeMode="safeMode"in e?e.safeMode:0,t.htmlReplacement="htmlReplacement"in e?e.htmlReplacement:"<mark>replaced HTML<mark>"}function r(n){switch(t.safeMode){case 0:return n;case 1:return"";case 2:return t.htmlReplacement;case 3:return e.replaceSpecialChars(n);default:}}t.safeMode,t.htmlReplacement,t.update=n,t.safeModeFilter=r,n({})})(e.Options||(e.Options={}));var t=e.Options})(Rimu||(Rimu={}));var Rimu;(function(e){var t=function(){function e(e){var t=e.split(/\r\n|\r|\n/g);for(var n in t)t[n]=t[n].replace(/\s+$/,"");this.lines=t,this.pos=0}return e.prototype.cursor=function(e){return typeof e=="undefined"&&(e=null),this.eof()?null:(e!==null&&(this.lines[this.pos]=e),this.lines[this.pos])},e.prototype.eof=function(){return this.pos>=this.lines.length},e.prototype.next=function(){return this.eof()?null:(this.pos++,this.eof()?null:this.cursor())},e.prototype.readTo=function(e){var t=[],n;while(!this.eof()){n=this.cursor().match(e);if(n){n.length>1&&t.push(n[1]),this.next();break}t.push(this.cursor()),this.next()}return n||e.toString()==="/^$/"&&this.eof()?t:null},e.prototype.skipBlankLines=function(){while(this.cursor()==="")this.next()},e}();e.Reader=t;var n=function(){function e(){this.buffer=[]}return e.prototype.write=function(e){this.buffer.push(e)},e.prototype.toString=function(){var e=this.buffer.join("");return e},e}();e.Writer=n})(Rimu||(Rimu={})),typeof exports!="undefined"&&(exports.Reader=Rimu.Reader,exports.Writer=Rimu.Writer);var Rimu;(function(e){(function(t){function n(){t.list=[]}function r(e){for(var n in t.list)if(t.list[n].name===e)return t.list[n].value;return null}function i(e,n){for(var r in t.list)if(t.list[r].name===e){t.list[r].value=n;return}t.list.push({name:e,value:n})}function s(n){for(var r in t.list){var i=t.list[r],s=RegExp("\\\\?\\{"+e.escapeRegExp(i.name)+"(\\|[\\s\\S]*?)?\\}","g");n=n.replace(s,function(e,t){if(e[0]==="\\")return e.slice(1);if(!t)return i.value.replace(/\$\d+/g,"");var n=i.value,r=t.slice(1).split("|");for(var s in r)n=n.replace("$"+(parseInt(s)+1),r[s]);return n=n.replace(/\$\d+/g,""),n})}return n=n.replace(/\\(\{[\w\-]+(?:\|[\s\S]*?)?\})/,"$1"),n}t.list=[],t.reset=n,t.get=r,t.set=i,t.render=s,typeof exports!="undefined"&&(exports.Variables=e.Variables)})(e.Variables||(e.Variables={}));var t=e.Variables})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){function r(t,r){if(t.eof())throw"premature eof";for(var i in n){var s=n[i],o=s.match.exec(t.cursor());if(o){if(o[0][0]==="\\"){t.cursor(t.cursor().slice(1));continue}var u;return s.filter?u=s.filter(o,s,t):u=e.replaceMatch(o,s.replacement,s),u=e.injectAttributes(u),r.write(u),t.next(),u&&!t.eof()&&r.write("\n"),!0}}return!1}function i(e){for(var t in n)if(n[t].id===e)return n[t];return null}var n=[{match:/^\\?\{([\w\-]+)\}\s*=\s*'(.*)'$/,replacement:"",variables:!0,filter:function(t,n){var r=t[1],i=t[2];return i=e.replaceOptions(i,n),e.Variables.set(r,i),""}},{match:/^\\?(\{[\w\-]+(?:\|.*)?\})$/,replacement:"",filter:function(t,n,r){var i=e.Variables.render(t[1]);return i===t[1]&&(i="\\"+i),r.lines=[].concat(r.lines.slice(0,r.pos+1),i.split("\n"),r.lines.slice(r.pos+1)),""}},{match:/^\\?((?:#|=){1,6})\s+(.+?)(?:\s+(?:#|=){1,6})?$/,replacement:"<h$1>$2</h$1>",variables:!0,spans:!0,filter:function(t,n){return t[1]=t[1].length.toString(),e.replaceMatch(t,n.replacement,n)}},{match:/^\\?\/{2}(.*)$/,replacement:""},{match:/^\\?<image:([^\s\|]+)\|([\s\S]+?)>$/,replacement:'<img src="$1" alt="$2">',variables:!0,specials:!0},{match:/^\\?<image:([^\s\|]+?)>$/,replacement:'<img src="$1" alt="$1">',variables:!0,specials:!0},{match:/^\\?<<#([a-zA-Z][\w\-]*)>>$/,replacement:'<div id="$1"></div>',variables:!0,specials:!0},{id:"attributes",match:/^\\?\.([a-zA-Z][\w\- ]*)?(#[a-zA-Z][\w\-]*)?(?:\s*)?(\[.+\])?$/,replacement:"",filter:function(n,r){return t.htmlAttributes="",n[1]&&(t.htmlAttributes+='class="'+e.trim(n[1])+'"'),n[2]&&(t.htmlAttributes+=' id="'+e.trim(n[2]).slice(1)+'"'),n[3]&&e.Options.safeMode===0&&(t.htmlAttributes+=" "+e.trim(n[3].slice(1,n[3].length-1))),t.htmlAttributes=e.trim(t.htmlAttributes),""}}];t.htmlAttributes="",t.render=r,t.getDefinition=i,typeof exports!="undefined"&&(exports.LineBlocks=e.LineBlocks)})(e.LineBlocks||(e.LineBlocks={}));var t=e.LineBlocks})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){function r(t,r){if(t.eof())throw"premature eof";for(var i in n){var s=n[i],o=t.cursor().match(s.openMatch);if(o){if(o[0][0]==="\\"&&parseInt(i)!==n.length-1){t.cursor(t.cursor().slice(1));continue}if(s.verify&&!s.verify(o))continue;var u=[];o.length>1&&u.push(o[1]),t.next();var a=t.readTo(s.closeMatch);a!==null&&(u=u.concat(a));if(s.skip)return!0;r.write(e.injectAttributes(s.openTag));var f=u.join("\n");return s.filter&&(f=s.filter(f,o)),s.container?f=e.renderSource(f):f=e.replaceOptions(f,s),r.write(f),r.write(s.closeTag),f&&!t.eof()&&r.write("\n"),!0}}return!1}function i(e){for(var t in n)if(n[t].id===e)return n[t];return null}var n=[{openMatch:/^\\?\{[\w\-]+\}\s*=\s*'(.*)$/,closeMatch:/^(.*)'$/,openTag:"",closeTag:"",variables:!0,filter:function(t,n){var r=n[0].match(/^\{([\w\-]+)\}/)[1];return e.Variables.set(r,t),""}},{openMatch:/^\\?\/\*+$/,closeMatch:/^\*+\/$/,openTag:"",closeTag:"",skip:!0},{id:"division",openMatch:/^\\?\.{2,}$/,closeMatch:/^\.{2,}$/,openTag:"<div>",closeTag:"</div>",container:!0},{openMatch:/^\\?"{2,}$/,closeMatch:/^"{2,}$/,openTag:"<blockquote>",closeTag:"</blockquote>",container:!0},{openMatch:/^\\?\-{2,}$/,closeMatch:/^\-{2,}$/,openTag:"<pre><code>",closeTag:"</code></pre>",variables:!0,specials:!0},{openMatch:/^\\?(<!.*|(?:<\/?(?:html|head|body|script|style|address|article|aside|audio|blockquote|canvas|dd|div|dl|fieldset|figcaption|figure|figcaption|footer|form|h1|h2|h3|h4|h5|h6|header|hgroup|hr|noscript|ol|output|p|pre|section|table|tfoot|ul|video)(?:[ >].*)?))$/i,closeMatch:/^$/,openTag:"",closeTag:"",variables:!0,filter:function(t){return e.Options.safeModeFilter(t)}},{id:"indented",openMatch:/^\\?(\s+.*)$/,closeMatch:/^$/,openTag:"<pre>",closeTag:"</pre>",variables:!0,specials:!0,filter:function(e){var t=e.search(/\S/),n=e.split("\n");for(var r in n){var i=n[r].search(/\S/);i>t&&(i=t),n[r]=n[r].slice(i)}return n.join("\n")}},{openMatch:/^(.*)$/,closeMatch:/^$/,openTag:"<p>",closeTag:"</p>",variables:!0,spans:!0}];t.render=r,t.getDefinition=i,typeof exports!="undefined"&&(exports.DelimitedBlocks=e.DelimitedBlocks)})(e.DelimitedBlocks||(e.DelimitedBlocks={}));var t=e.DelimitedBlocks})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){function i(e,t){if(e.eof())throw"premature eof";var n;return(n=a(e))?(r=[],s(n,e,t),!0):!1}function s(t,n,i){r.push(t.id),i.write(e.injectAttributes(t.def.listOpenTag));var s;for(;;){s=o(t,n,i);if(!s||s.id!==t.id)return i.write(t.def.listCloseTag),r.pop(),s;t=s}}function o(t,n,i){var o=t.def,f=t.match,l;f.length===4&&(i.write(o.termOpenTag),l=e.replaceOptions(f[1],{variables:!0,spans:!0}),i.write(l),i.write(o.termCloseTag)),i.write(o.itemOpenTag);var c=new e.Writer;c.write(f[f.length-1]),c.write("\n"),n.next();var h;h=u(t,n,c),l=c.toString(),l=e.replaceOptions(l,{variables:!0,spans:!0}),i.write(l);for(;;){if(!h)return i.write(o.itemCloseTag),null;if(h.isListItem)return r.indexOf(h.id)!==-1?(i.write(o.itemCloseTag),h):(h=s(h,n,i),i.write(o.itemCloseTag),h);if(h.isDivision||h.isIndented){e.DelimitedBlocks.render(n,i),n.skipBlankLines();if(n.eof())return i.write(o.itemCloseTag),null;h=a(n)}}}function u(e,t,n){var r;for(;;){if(t.eof())return null;if(t.cursor()==="")return t.skipBlankLines(),t.eof()?null:a(t,{division:!0,indented:!0});r=a(t,{division:!0});if(r)return r;n.write(t.cursor()),n.write("\n"),t.next()}}function a(t,r){typeof r=="undefined"&&(r={});var i=e.LineBlocks.getDefinition("attributes").match;i.test(t.cursor())&&e.LineBlocks.render(t,new e.Writer);var s=t.cursor(),o={},u;for(var a in n){var f=n[a].match.exec(s);if(f)return f[0][0]==="\\"?(t.cursor(t.cursor().slice(1)),null):(o.match=f,o.def=n[a],o.id=f[f.length-2],o.isListItem=!0,o)}if(r.division){u=e.DelimitedBlocks.getDefinition("division");if(u.openMatch.test(s))return o.isDivision=!0,o}if(r.indented){u=e.DelimitedBlocks.getDefinition("indented");if(u.openMatch.test(s))return o.isIndented=!0,o}return null}var n=[{match:/^\\?\s*(-|\*{1,4})\s+(.*)$/,listOpenTag:"<ul>",listCloseTag:"</ul>",itemOpenTag:"<li>",itemCloseTag:"</li>"},{match:/^\\?\s*(?:\d*)(\.{1,4})\s+(.*)$/,listOpenTag:"<ol>",listCloseTag:"</ol>",itemOpenTag:"<li>",itemCloseTag:"</li>"},{match:/^\\?\s*(.*[^:])(\:{2,4})(|\s+.*)$/,listOpenTag:"<dl>",listCloseTag:"</dl>",itemOpenTag:"<dd>",itemCloseTag:"</dd>",termOpenTag:"<dt>",termCloseTag:"</dt>"}],r;t.render=i,typeof exports!="undefined"&&(exports.Lists=t)})(e.Lists||(e.Lists={}));var t=e.Lists})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){function n(e){var t=[{text:e,done:!1}];return i(t),s(t),u(t),r(t)}function r(e){var t=[];for(var n in e)t.push(e[n].text);return t.join("")}function i(t){var n=e.Quotes.findRe,r=0,i=t[r],s,o;n.lastIndex=0;for(;;){i.done?s=!0:(o=n.exec(i.text),s=!o);if(s){r++;if(r>=t.length)break;i=t[r],o&&(n.lastIndex=0);continue}if(o[0][0]==="\\")continue;var u=e.Quotes.find(o[1]);if(u.verify&&!u.verify(o,n))continue;var a=o.input.slice(0,o.index),f=o[2],l=o.input.slice(n.lastIndex);t.splice(r,1,{text:a,done:!1},{text:u.openTag,done:!0},{text:f,done:!1},{text:u.closeTag,done:!0},{text:l,done:!1}),r+=2,i=t[r],u.spans||(i.text=e.Quotes.unescape(i.text),i.text=e.replaceSpecialChars(i.text),i.done=!0,r+=2,i=t[r]),n.lastIndex=0}for(var c in t)i=t[c],i.done||(i.text=e.Quotes.unescape(i.text))}function s(t){for(var n in e.Replacements.defs)o(t,e.Replacements.defs[n])}function o(t,n){var r=n.match,i=0,s=t[i],o,u;r.lastIndex=0;for(;;){s.done?o=!0:(u=r.exec(s.text),o=!u);if(o){i++;if(i>=t.length)break;s=t[i],u&&(r.lastIndex=0);continue}var a=u.input.slice(0,u.index),f=u.input.slice(r.lastIndex);t.splice(i,1,{text:a,done:!1},{text:"",done:!0},{text:f,done:!1}),i++,s=t[i],u[0][0]==="\\"?(s.text=u.input.slice(u.index+1,r.lastIndex),s.text=e.replaceSpecialChars(s.text)):n.filter?s.text=n.filter(u,n):s.text=e.replaceMatch(u,n.replacement,n),i++,s=t[i],r.lastIndex=0}}function u(t){var n;for(var r in t)n=t[r],n.done||(n.text=e.replaceSpecialChars(n.text))}t.render=n,typeof exports!="undefined"&&(exports.Spans=e.Spans)})(e.Spans||(e.Spans={}));var t=e.Spans})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){function o(e){for(var t in n)if(n[t].quote===e)return n[t]}function u(e){return e.replace(r,"$1")}var n=[{quote:"_",openTag:"<em>",closeTag:"</em>",spans:!0},{quote:"*",openTag:"<strong>",closeTag:"</strong>",spans:!0},{quote:"`",openTag:"<code>",closeTag:"</code>",spans:!1},{quote:"=",openTag:"<del>",closeTag:"</del>",spans:!0,verify:function(e,t){var n=e.input[e.index-1]||"",r=e.input[t.lastIndex]||"";return!/[a-zA-Z]/.test(n)||!/["']/.test(r)}},{quote:"+",openTag:"<ins>",closeTag:"</ins>",spans:!0},{quote:"#",openTag:"<mark>",closeTag:"</mark>",spans:!0,verify:function(e,t){var n=e.input[e.index-1]||"",r=e.input[t.lastIndex]||"";return!/</.test(n)||!/[a-zA-Z]/.test(r)}},{quote:"~",openTag:"<sub>",closeTag:"</sub>",spans:!0},{quote:"^",openTag:"<sup>",closeTag:"</sup>",spans:!0}];t.findRe;var r,i=[];for(var s in n)i.push(e.escapeRegExp(n[s].quote));t.findRe=RegExp("\\\\?("+i.join("|")+")([^\\s\\\\]|\\S[\\s\\S]*?[^\\s\\\\])\\1","g"),r=RegExp("\\\\("+i.join("|")+")","g"),t.find=o,t.unescape=u})(e.Quotes||(e.Quotes={}));var t=e.Quotes})(Rimu||(Rimu={}));var Rimu;(function(e){(function(t){t.defs=[{match:/\\?(&[\w#][\w]+;)/g,replacement:"$1",specials:!1},{match:/\\? \+(?:\n|$)/g,replacement:"<br>\n",specials:!1},{match:/\\?<<#([a-zA-Z][\w\-]*)>>/g,replacement:'<span id="$1"></span>',specials:!0},{match:/\\?<image:([^\s\|]+)\|([\s\S]+?)>/g,replacement:'<img src="$1" alt="$2">',specials:!0},{match:/\\?<image:([^\s\|]+?)>/g,replacement:'<img src="$1" alt="$1">',specials:!0},{match:/\\?<(\S+@[\w\.\-]+)\|([\s\S]+?)>/g,replacement:'<a href="mailto:$1">$2</a>',specials:!0},{match:/\\?<(\S+@[\w\.\-]+)>/g,replacement:'<a href="mailto:$1">$1</a>',specials:!0},{filter:function(t,n){var r=e.replaceMatch(t,n.replacement,n);return e.Options.safeModeFilter(r)},match:/\\?(<[!\/]?[a-zA-Z\-]+(:?\s+[^<>&]+)?>)/g,replacement:"$1",specials:!1},{match:/\\?<(\S+?)\|([\s\S]+?)>/g,replacement:'<a href="$1">$2</a>',specials:!0},{match:/\\?<(\S+?)>/g,replacement:'<a href="$1">$1</a>',specials:!0}]})(e.Replacements||(e.Replacements={}));var t=e.Replacements})(Rimu||(Rimu={}));